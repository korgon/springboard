<div class="heading">
	<div class="title">
		<div class="logo"></div>
		<div class="subtitle" ng-click="showMenu = !showMenu">SPRIΠGBOΛRD</div>
	</div>
	<div class="mainmenu" ng-include src="'/partials/_above_menu.html'" ng-class="{ 'show': showMenu }" ng-init="showMenu = false"></div>
	<input id="frameurl" name="url" autocomplete="off" spellcheck="false" ng-model="vm.session.url" ng-change="vm.changeUrl()">
	<div class="openurl" ng-click="vm.openUrl(vm.session.url)"></div>
	<div class="line"></div>
	<div class="worksite"><a class="currentsite" ng-click="vm.toggleEditor()"><span id="currentsite">{{ vm.site.name }}</span></a>
		<div class="editor-container" ng-class="{'show': vm.session.showOptions}">

			<ul class="tab-control" ng-class="{ disabled: vm.edited }">
				<li><a ng-class="{ 'active': (vm.session.current_tab == 'uigen')}" ng-click="vm.switchTab('uigen')"><span class="icon uis"></span></a></li>
				<li><a ng-class="{ 'active': (vm.session.current_tab == 'settings')}" ng-click="vm.switchTab('settings')"><span class="icon config"></span></a></li>
			</ul>

			<div ng-if="vm.session.current_tab" ng-switch="vm.session.current_tab">

				<div ng-switch-when="settings" ng-init="vm.initVtab('default')">
					<div class="tab-wrap">
						<div class="header settings"><span>settings</span></div>
					</div>

					<div>
						<div class="vtab-wrap">
							<div class="vtab-control-wrap">
								<ul class="vtab-control" ng-class="{ disabled: vm.edited }">
									<li ng-class="{ 'active': vm.activeVtab('default') == 'files' }"><a ng-click="vm.switchVtab('files', 'default')"><span class="icon files"></span></a></li>

									<li ng-class="{ 'active': vm.activeVtab('default') == 'proxy' }"><a ng-click="vm.switchVtab('proxy', 'default')"><span class="icon proxy"></span></a></li>

									<li ng-class="{ 'active': vm.activeVtab('default') == 'history' }"><a ng-click="vm.switchVtab('history', 'default')"><span class="icon pulse"></span></a></li>



									<li ng-class="{ 'active': vm.activeVtab('default') == 'settings' }"><a ng-click="vm.switchVtab('settings', 'default')"><span class="icon settings"></span></a></li>
								</ul>
							</div>

							<div class="vtab" ng-switch="vm.session.tab['settings'].vtab['default'].tab">

								<div ng-switch-when="settings">
									<div class="vtab-block">
										<ul class="variable-wrap">
											<li class="variable-container" ng-repeat="(name, variable) in vm.site.settings" ng-include="'variables'"></li>
											<li>
												<div class="vtab-blockhead">
													<span>screen capture</span>
													<span ng-click="vm.captureScreen()" class="icon small capture"></span>
												</div>
												<div>
													<div class="variable-description">
														<span>generate screen shot for site</span>
													</div>
												</div>
											</li>
										</ul>
									</div>
								</div>

								<div ng-switch-when="files">
									<ul class="settings-files">
										<li class="root"><span class="icon folder-root"></span></li>
										<ul class="directory-contents">
											<li class="{{ details.type }} {{ details.extension.replace('.', '') }}" ng-repeat="details in vm.files.root.contents | orderFilesBy: 'type'" ng-include="'fileTree'"></li>
										</ul>
									</ul>
								</div>

								<div ng-switch-when="proxy">
									<div class="vtab-block">
										<ul class="variable-wrap">
											<li class="variable-container" ng-repeat="(name, variable) in vm.site.proxy" ng-include="'variables'"></li>
										</ul>
									</div>
								</div>

								<div ng-switch-when="history">
									<div class="vtab-head">{{ vm.session.tab['settings'].vtab['default'].tab }}</div>
									<ul class="settings-history">
									</ul>
								</div>

							</div>
						</div>
					</div>

					<div class="spacer"></div>
				</div>

				<div ng-switch-when="uigen">
					<div class="tab-wrap">
						<div class="header ui"><span>UI Generator</span></div>
					</div>

					<div class="ui-scroller">
						<ul class="ui-choices">
							<li class="uicontainer" ng-repeat="ui in vm.site.catalogs" id="{{ 'ui_' + ui.name }}" ng-init="vm.initVtab(ui.name)">
								<div class="ui" ng-class="{ active: vm.session.tab['uigen'].vtab[ui.name].visible && vm.session.tab['uigen'].current == ui.name, disabled: vm.edited }" ng-click="vm.toggleUI(ui.name)" ng-if="!vm.session.tab['uigen'].current || vm.session.tab['uigen'].current == ui.name || !vm.site.catalogs[vm.session.tab['uigen'].current]">
									<span class="brackets">[</span>
									<span>{{ ui.name }}</span>
									<span class="brackets">]</span>
								</div>
								<div ng-if="vm.session.tab['uigen'].vtab[ui.name].visible && vm.session.tab['uigen'].current == ui.name">
									<div class="vtab-wrap">

										<div class="vtab-control-wrap">
											<ul class="vtab-control" ng-class="{ disabled: vm.edited }">
												<li><a ng-click="vm.installModule(ui)"><span class="icon module-add"></span></a></li>

												<li ng-repeat="module in ui.modules" ng-class="{ 'active': vm.activeVtab(ui.name) == 'module_' + module.name }"><a ng-click="vm.switchVtab('module_' + module.name, ui.name)"><span class="icon module-{{ module.icon }}" ng-class="{ removed: !module.enabled }"></span></a></li>

												<li ng-class="{ 'active': vm.activeVtab(ui.name) == 'styles' }"><a ng-click="vm.switchVtab('styles', ui.name)"><span class="icon styles"></span></a></li>

												<li ng-if="!vm.isEmpty(ui.variables)" ng-class="{ 'active': vm.activeVtab(ui.name) == 'variables' }"><a ng-click="vm.switchVtab('variables', ui.name)"><span class="icon variables"></span></a></li>

												<li ng-class="{ 'active': vm.activeVtab(ui.name) == 'tags' }"><a ng-click="vm.switchVtab('tags', ui.name)"><span class="icon tags"></span></a></li>

												<li ng-class="{ 'active': vm.activeVtab(ui.name) == 'settings' }"><a ng-click="vm.switchVtab('settings', ui.name)"><span class="icon settings"></span></a></li>
											</ul>
										</div>

										<div class="vtab" ng-switch="vm.session.tab['uigen'].vtab[ui.name].tab">

											<div ng-switch-when="styles">
												<div class="vtab-block">
													<ul class="variable-wrap">
														<li class="variable-container" ng-repeat="(name, variable) in ui.styles" ng-include="'variables'"></li>
														<li ng-if="vm.isEmpty(ui.styles)">
															<div class="vtab-subhead">nothing to see here...</div>
														</li>
													</ul>
												</div>
											</div>

											<div ng-switch-when="variables">
												<div class="vtab-block">
													<ul class="variable-wrap">
														<li class="variable-container" ng-repeat="(name, variable) in ui.variables" ng-include="'variables'"></li>
														<li ng-if="vm.isEmpty(ui.variables)">
															<div class="vtab-subhead">nothing to see here...</div>
														</li>
													</ul>
												</div>
											</div>

											<div ng-switch-when="tags">
												<div class="vtab-head">Tagsies</div>
												<div class="vtab-block"></div>
											</div>

											<div ng-switch-when="settings">
												<div class="vtab-block">
													<ul class="variable-wrap">
														<li class="variable-container" ng-repeat="(name, variable) in ui.settings" ng-include="'variables'"></li>
														<li ng-if="vm.isEmpty(ui.settings)" class="variable-container">
															<div class="vtab-subhead">nothing to see here...</div>
														</li>
														<li class="variable-container">
															<div class="vtab-blockhead">
																<span>script tag</span>
																<span copycat="#uiscript" class="icon small copy"></span>
															</div>
															<div>
																<input id="uiscript" type=hidden value="{{ vm.getScriptTag(ui.type) }}">
																<div class="variable-description">
																	<span>copy {{ ui.type }} script loader to the clipboard</span>
																</div>
															</div>
														</li>
														<li class="variable-container">
															<div class="vtab-blockhead">
																<span>force recompile</span>
																<span ng-click="vm.forceCompile(ui)" class="icon small compile"></span>
															</div>
															<div>
																<div class="variable-description">
																	<span>force a compile of the entire ui</span>
																</div>
															</div>
														</li>
													</ul>
												</div>
											</div>

											<div ng-switch-default>
												<div ng-repeat="module in ui.modules" ng-if="vm.session.tab['uigen'].vtab[ui.name].tab == 'module_' + module.name">
													<div class="vtab-head"><span class="vtab-title" ng-click="vm.moduleInfo(module)">{{ module.name }}</span><span ng-click="module.enabled = !module.enabled; vm.updateModule(ui.name, module.name)" ng-model="module.enabled" class="switch" ng-class="{ off: !module.enabled}"></span></div>

													<div class="vtab-subhead">{{ module.type }} module v{{ module.version }}</div>

													<br>
													<div class="vtab-contents" ng-class="{ disabled: !module.enabled }">
														<div class="vtab-overlay" ng-hide="module.enabled"></div>

														<div class="vtab-block" ng-if="!vm.isEmpty(vm.site.catalogs[ui.name].modules[module.name].themes[vm.site.catalogs[ui.name].modules[module.name].theme].variables)">
															<ul class="variable-wrap">
																<li class="variable-container" ng-repeat="(name, variable) in vm.site.catalogs[ui.name].modules[module.name].themes[vm.site.catalogs[ui.name].modules[module.name].theme].variables">
																	<div class="vtab-blockhead">{{ name }}</div>
																	<div>
																		<div ng-if="variable.description" class="variable-description">{{ variable.description }}</div>
																		<input class="variable-input" ng-change="vm.checkChange()" ng-model="variable.value" placeholder="..." autocomplete="off" spellcheck="false">
																	</div>
																</li>
																<li ng-if="vm.isEmpty(vm.site.catalogs[ui.name].modules[module.name].themes[vm.site.catalogs[ui.name].modules[module.name].theme].variables)">
																	<div class="vtab-subhead">no variables defined...</div>
																</li>
															</ul>
														</div>

														<div class="vtab-block" ng-if="!vm.isSingular(vm.uis[ui.type].modules[module.type.split('/')[1]].themes)">
															<div class="vtab-blockhead">themes</div>

															<ul class="module-themes-container">
																<li ng-repeat="theme in module.themes">
																	<span class="theme-name">{{ theme.name }}</span>
																	<span ng-if="vm.site.catalogs[ui.name].modules[module.name].theme == theme.name" title="active" class="icon active on"></span>
																	<span ng-if="vm.site.catalogs[ui.name].modules[module.name].theme != theme.name" title="inactive" class="icon active off" ng-click="vm.site.catalogs[ui.name].modules[module.name].theme = theme.name; vm.updateModule(ui.name, module.name);"></span>
																	<span title="custom" class="icon custom disabled" ng-if="!vm.uis[ui.type].modules[module.type.split('/')[1]].themes[theme.name]"></span>
																</li>
																<li ng-repeat="theme in vm.uis[ui.type].modules[module.type.split('/')[1]].themes" ng-if="!vm.site.catalogs[ui.name].modules[module.name].themes[theme.name]">
																	<span class="theme-name">{{ theme.name }}</span>
																	<span title="{{ vm.site.catalogs[ui.name].modules[module.name].themes[theme.name] ? 'installed' : 'install' }}" class="icon install" ng-click="vm.installModuleTheme(ui.name, module.name, theme.name)"></span>
																</li>
															</ul>
														</div>

													</div>
												</div>
											</div>

										</div>
									</div>
								</div>
							</li>
							<li>
								<div class="ui-add solo" ng-if="vm.isEmpty(vm.site.catalogs) || !(vm.session.tab['uigen'].current && vm.site.catalogs[vm.session.tab['uigen'].current])" ng-init="vm.new_ui_show = (vm.isEmpty(vm.site.catalogs) ? true : false)">
									<div id="addbutton" ng-click="vm.showAddInput()" ng-hide="vm.new_ui_show">
										<span class="brackets">[</span>
										<span class="add"></span>
										<span class="brackets">]</span>
									</div>
									<form id="adduiinput" name="UIform" novalidate class="visible" ng-if="vm.new_ui_show">
										<label for="uiname_input">Name</label>
										<input type="text" name="uiname" id="uiname_input" autocomplete="off" focus-on ng-model="vm.new_ui.name" required ng-pattern="/^[\w-_]{2,}$/i" ng-init="vm.new_ui.type = 'v3'">

										<label for="uitypeinput" ng-if="vm.uis.length > 1">Type</label>
										<select id="uitypeinput" ng-if="vm.uis.length > 1" required ng-model="vm.new_ui.type" ng-options="ui.type as ui.type for ui in vm.uis">
										</select>

										<div class="buttons">
											<input class="button" type="submit" value="Add" ng-click="vm.installUI()" ng-disabled="UIform.$invalid">
											<input class="button" type="button" value="Cancel" ng-click="vm.hideAddInput()">
										</div>
									</form>
								</div>
								<div class="spacer"></div>
							</li>
						</ul>
					</div>
				</div>

			</div>

			<ul class="action-buttons" ng-if="vm.site && vm.edited">
				<li><a ng-click="vm.saveChanges()"><span class="icon save"></span></a></li>
				<li><span class="icon push disabled"></span></li>
				<li><a ng-click="vm.reloadSite()"><span class="icon reload"></span></a></li>
			</ul>

			<ul class="action-buttons" ng-if="vm.site && !vm.edited">
				<li><a ng-click="vm.commitSite()"><span class="icon commit"></span></a></li>
				<li><a ng-click="vm.pushSite()"><span class="icon push"></span></a></li>
				<li>
					<a ng-click="vm.site.cloud_files.length && vm.publishSite()">
						<span class="icon upload" ng-class="{ disabled: !vm.site.cloud_files.length }"></span>
					</a>
				</li>
			</ul>

		</div>
	</div>
</div>



<!-- Used for variables (colors, boolean, siteid, etc...) -->
<script type="text/ng-template" id="variables">
	<div class="vtab-blockhead">
		<span>{{ variable.label || name }}</span>
		<span ng-if="variable.type == 'boolean'" ng-click="variable.value = !variable.value; vm.checkChange();" ng-model="variable.value" class="switch" ng-class="{ off: !variable.value}"></span>
		<span ng-if="variable.type == 'color'" class="variable-color background">&#x2B22;</span>
		<span ng-if="variable.type == 'color'" class="variable-color" style="color: {{ variable.value }};">&#x2B22;</span>
	</div>
	<div>
		<div ng-if="variable.description" class="variable-description">{{ variable.description }}</div>
		<input ng-if="variable.type != 'boolean'" ng-change="vm.checkChange()" class="variable-input" ng-model= "variable.value" placeholder="..." autocomplete="off" spellcheck="false">
	</div>
</script>

<!-- Used for recursive file structure -->
<script type="text/ng-template" id="fileTree">
	<div class="filewrapper" ng-if="details.type == 'file'" ng-init="details.show = false" ng-class="{ show: details.show }">
		<div class="filehead" ng-if="details.type == 'file'" ng-click="details.show = !details.show">
			<span class="icon small extension-{{ details.extension }}">
				<span class="icon tiny selected" ng-if="vm.site.thumb == ('/sites/' + vm.site.name + '/' + details.path) || details.path == vm.site.default_html"></span>
			</span>
			<span class="filename" ng-class="{ cloud: vm.site.cloud_files.indexOf(details.path) != -1 }">{{ details.name }}</span>
		</div>
		<div class="filedetails">
			<div class="fileactions">
				<span class="icon tiny active" ng-if="details.extension == 'html'" ng-class="{ disabled: details.path != vm.site.default_html }" ng-click="vm.setDefaultHTML(details.path)"></span>
				<span class="icon tiny active"  ng-if="['png', 'jpeg', 'jpg', 'gif'].indexOf(details.extension) != -1" ng-class="{ disabled: vm.site.thumb != ('/sites/' + vm.site.name + '/' + details.path) }" ng-click="vm.setThumb(details.path)"></span>
				<span class="icon tiny cloud" ng-class="{ disabled: vm.site.cloud_files.indexOf(details.path) == -1 }" ng-click="vm.toggleCloudFile(details.path)"></span>
				<span class="icon tiny view" ng-click="vm.setUrl(vm.root_url + details.path)" ng-class="{ disabled: vm.session.frameurl.match(vm.site.name + '/' + details.path) }"></span>
				<span class="icon tiny open" ng-click="vm.openUrl(vm.root_url + details.path)"></span>
				<span class="filestats">{{ details.size }}</span>
			</div>
		</div>
	</div>

	<span class="filewrapper" ng-if="details.type == 'directory'" ng-click="vm.toggleDir(details)">
		<span ng-if="details.collapsed" class="icon small folder"></span>
		<span ng-if="!details.collapsed" class="icon small folder-open"></span>
		<span class="filename">{{ details.name }}</span>
	</span>

	<ul class="directory-contents" ng-if="details.type == 'directory'" ng-init="vm.checkDirState(details)" ng-class="{ collapsed: details.collapsed }">
		<li class="{{ details.type }}" ng-repeat="details in details.contents | orderFilesBy: 'type'" ng-include="'fileTree'"></li>
	</ul>
</script>
